name: "ğŸ”§ Setup Flutter"
description: "Prepare the Flutter environment for the release workflow"

runs:
  using: "composite"
  steps:
    - name: ğŸ“‚ Checkout Code
      uses: actions/checkout@v2
    - name: ğŸ“ Extract Flutter Version
      id: fvmrc
      uses: ActionsTools/read-json-action@main
    - name: ğŸš€ Set Up Flutter Environment
      uses: subosito/flutter-action@v1
      with:
        flutter-version: ${{ steps.fvmrc.outputs.flutter }}
    - name: ğŸ“¦ Install Dependencies
      run: flutter pub get
    - name: ğŸ”¢ Set Major Version
      run: echo "MAJOR_VERSION=$(echo $GITHUB_REF | cut -d '.' -f 1)" >> .env
    - name: ğŸ”¢ Set Minor Version
      run: echo "MINOR_VERSION=$(echo $GITHUB_REF | cut -d '.' -f 2)" >> .env
    - name: ğŸ”¢ Set Patch Version
      run: echo "PATCH_VERSION=$(echo $GITHUB_REF | cut -d '.' -f 3)" >> .env
    - name: ğŸ“ Write Environment File
      uses: DamianReeves/write-file-action@v1.3
      with:
        path: .env
        write-mode: append
        contents: |
          # ğŸŒŸ Environment Configuration for LB Planner

          # ğŸŒ Moodle Server URL
          MOODLE_ENDPOINT=${{ env.MOODLE_ENDPOINT }}

          # ğŸŒ LB Planner Website URL
          LB_PLANNER_ENDPOINT=${{ env.LB_PLANNER_ENDPOINT }}

          # ğŸ”„ Data Refresh Intervals (in milliseconds)
          REFRESH_INTERVAL=10000
          IMPORTANT_REFRESH_INTERVAL=500
          LESS_IMPORTANT_REFRESH_INTERVAL=300000

          # ğŸ› ï¸ Sentry Configuration
          SENTRY_DSN=${{ secrets.SENTRY_DSN }}

          # ğŸ·ï¸ Application Versioning
          APP_NAME="LB Planner"
          BUILD_CHANNEL=stable

          # ğŸ“Š PostHog Analytics
          POSTHOG_API_KEY=${{ env.POSTHOG_API_KEY }}
          POSTHOG_HOST=${{ env.POSTHOG_HOST }}
          PRIVACY_POLICY_URL=${{ env.PRIVACY_POLICY_URL }}
